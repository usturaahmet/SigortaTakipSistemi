@model SigortaTakipSistemi.Models.PoliceTuru
@{
    ViewData["Title"] = "Yeni Poliçe Türü";
}

<h2>Yeni Poliçe Türü</h2>

<form asp-action="Create" method="post" novalidate>
    @Html.AntiForgeryToken()

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="row g-3">
        <div class="col-md-6">
            <label asp-for="Ad" class="form-label"></label>
            <input asp-for="Ad" class="form-control" />
            <span asp-validation-for="Ad" class="text-danger"></span>
        </div>

        <!-- Varsayılan oranlar (fallback): şirket bazlı oran tanımlı değilse kullanılacak -->
        <div class="col-md-3">
            <label asp-for="Prim" class="form-label">Prim (%)</label>
            <input asp-for="Prim" type="number" step="0.01" class="form-control" />
            <span asp-validation-for="Prim" class="text-danger"></span>
        </div>

        <div class="col-md-3">
            <label asp-for="AcentaPrimi" class="form-label">Acenta Primi (%)</label>
            <input asp-for="AcentaPrimi" type="number" step="0.01" class="form-control" />
            <span asp-validation-for="AcentaPrimi" class="text-danger"></span>
        </div>
    </div>

    <div class="mt-3">
        <button type="submit" class="btn btn-primary">Kaydet</button>
        <a asp-action="Index" class="btn btn-secondary">Listeye Dön</a>
    </div>
</form>

@section Scripts{
    <partial name="_ValidationScriptsPartial" />

    <script>
        function showRates(r){
            if(!r){
                $('#PrimYuzde, #AcentaPrimiYuzde').val('');
                $('#OranUyari').removeClass('d-none');
            }else{
                $('#PrimYuzde').val(r.prim);
                $('#AcentaPrimiYuzde').val(r.acenta);
                $('#OranUyari').addClass('d-none');
            }
        }
        function loadRates(){
            var s = $('#SigortaSirketiId').val(), t = $('#PoliceTuruId').val();
            if(!s || !t){ showRates(null); return; }
            $.get('@Url.Action("GetRates","PoliceTuruSirket")', { sirketId:s, turId:t })
             .done(showRates).fail(function(){ showRates(null); });
        }
        $('#SigortaSirketiId,#PoliceTuruId').on('change', loadRates);
        $(loadRates);
    </script>
}
